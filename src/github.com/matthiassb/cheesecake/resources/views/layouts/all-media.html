{{> header }}


    <!-- Portfolio Grid Section -->
    <section class="flex-1">
        <div class="container">
            <div class="row" style="margin-top:20px;">
                <div class="col-lg-12 text-center">
                    <h2>Television</h2>
                    <hr class="star-primary">
                </div>
            </div>
            <div class="row">
              {{#unless this.Shows }}
              <div class="col-xs-12 col-lg-4 portfolio-item">
                  <a class="portfolio-link">
                      <div class="caption">
                          <div class="caption-content">
                            <h3>No Media Found</h3>
                            <br/>
                            <i class="fa fa-play-circle fa-3x"></i>
                          </div>
                      </div>
                      <img src="/assets/img/default-poster.png" class="img-responsive" >
                  </a>
              </div>
              {{/unless}}

              {{#each this.Shows }}

              <div class="col-xs-12 col-lg-4 portfolio-item">
                  <a class="portfolio-link"  data-key="{{ ShowInfo.ID }}">
                      <div class="caption">
                          <div class="caption-content">
                            <h3>{{ ShowInfo.Name }}</h3>
                            <br/>
                            <i class="fa fa-play-circle fa-3x"></i>
                          </div>
                      </div>
                      <img src="/data/{{ ShowInfo.ID }}/poster.jpg" class="img-responsive" style="width: 100%; height: 540px;">
                  </a>
              </div>
              {{/each}}

            </div>
        </div>
    </section>


    <!-- Portfolio Modals -->
    <div class="portfolio-modal modal fade" id="mediaModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 ">
                        <div class="modal-body">
                            <img id="banner" src="" style="width: 100%;">
                            <h2 id="season">Title</h2>
                            <hr class="star-primary">
                            <div class="row" id="episodes">
                              <div class="col-lg-4 col-xs-12 portfolio-item">
                                <p class="title" style="margin: 0px;"></p>
                                <p><span class="episodeStatus"></span>&nbsp;<span class="episodeNumber"></span></p>
                                  <a href="" class="portfolio-link">
                                      <div class="caption">
                                          <div class="caption-content">
                                            <h3>View Episode</h3>
                                          </div>
                                      </div>
                                      <img src="{{ ../host }}{{ thumb }}" class="img-responsive" alt="" style="width:347px; height: 195px">
                                  </a>
                              </div>
                            </div>
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer id="footer" class="text-center ">
      <div class="container">
          <div class="row">
              <div class="col-lg-12">
                  Copyright &copy; Matthias Brooks
              </div>
          </div>
      </div>
    </footer>

    <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
    <div class="scroll-top page-scroll visible-xs visible-sm">
        <a class="btn btn-primary" href="#page-top">
            <i class="fa fa-chevron-up"></i>
        </a>
    </div>

    <!-- jQuery -->
    <script src="/assets/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script src="/assets/js/classie.js"></script>


    <!-- Custom Theme JavaScript -->
    <script src="/assets/js/freelancer.js"></script>
    <script src="/assets/js/bootstrap-switch.js"></script>
    <script src="/assets/js/sweetalert.min.js"></script>
    <script src="/assets/js/sugar.min.js"></script>

    <script>

      var key;
      $(document).ready(function(){
        if(getParameterByName("show") != ""){
          showSeasonEpisodes(
            getParameterByName("show"),
            getParameterByName("season")
          );
        }
        $('#mediaModal').on('hidden.bs.modal', function (e) {
          history.pushState({}, "", "/media/tv");
        })
        $(".portfolio-link").click(function(){

          key = $(this).data("key");

          if($(this).attr("href") == ""){
            swal({
              title: "No Media Found",
              text: "<a href='/add-media' class='btn btn-primary'>Add Media Here!</a>",
              html: true,
              showConfirmButton: false,
              allowOutsideClick: true,
              showCancelButton: true
            });
            return;
          }
          $.get("/api/media/tv/" + key,
          function(res){
            var buttons = "";
            for(var i = 1; i <= res.data.ShowInfo.SeasonCount; i++){
              buttons += "<button data-season='" + (i) + "' class='showSeason btn btn-primary'>Season " + (i) + "</button>";
            }
            swal({
              title: "Seasons",
              text: buttons,
              html: true,
              showConfirmButton: false,
              allowOutsideClick: true,
              showCancelButton: true
            });
          });
        });

        function showSeasonEpisodes(key, seasonNumber){
          $.get("/api/media/tv/" + key + "/season/" + seasonNumber,
           function(res){
             var now = Date.create("now");
             history.pushState({}, "", "/media/tv?show=" + key + "&season=" + seasonNumber);
             $("#season").text("Season " + seasonNumber);
             $("#episodes").children().not(":first").remove();
             $("#episodes div img").attr("src", "/data/" + key + "/" + res.Episodes["1"].ID + "/sc-medium.jpg");
             $("#episodes a").attr("href", "/media/tv/" + res.ShowInfo.ID + "/" + res.Episodes["1"].ID);
             $("#episodes div .title").text(res.Episodes["1"].Name);
             $("#episodes div .episodeNumber").text("Episode " + res.Episodes["1"].Number);

             if(Date.create(res.Episodes["1"].AirStamp).isAfter("now")){
               $("#episodes div .episodeStatus").html('<i class="fa fa-calendar-times-o" aria-hidden="true" style="color: red"></i>');
             }
             delete res.Episodes["1"];

             $.each(res.Episodes, function(k, v){

               $clone = $("#episodes div:first").clone();

               $clone.find("img").attr("src", "/data/" + key + "/" + v.ID + "/sc-medium.jpg");

               $clone.find("a").attr("href", "/media/tv/" + res.ShowInfo.ID + "/" + v.ID);
               $clone.find(".title").text(v.Name);
               $clone.find(".episodeNumber").text("Episode " + v.Number);
               date = Date.create(v.AirStamp)
               if(date.isAfter("now")){
                 $clone.find(".episodeStatus").html('<i class="fa fa-calendar-times-o" aria-hidden="true" style="color: red" data-toggle="tooltip" data-placement="left" title="Not Aired Yet"></i>');
               }

               $("#episodes").append($clone);
             });
              $(function () {
                $('[data-toggle="tooltip"]').tooltip()
              })
             $('#mediaModal').modal('toggle')
           }
         );
        }
        $(document).on('click', '.showSeason', function(){
          var seasonNumber = $(this).data("season");
          showSeasonEpisodes(key, seasonNumber);
        });
        function getParameterByName(name) {
          name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
          var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
              results = regex.exec(location.search);
          return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }
    });


    </script>

</body>

</html>
